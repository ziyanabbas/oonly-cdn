<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oonly Tracker Integration Test</title>
</head>
<body>
    <h1>Oonly Tracker Integration Test</h1>
    <p>This page tests the integration of your obfuscated tracker.</p>
    
    <button onclick="testTracking()">Test Tracking 1</button>
    <button onclick="testIdentify()">Test Identify</button>
    
    <div id="status">Loading tracker...</div>
    <div id="debug"></div>

    <!-- Try local build first, then GitHub Pages -->
    <script>
        // Try to load tracker with fallback
        function loadTracker() {
            const debug = document.getElementById('debug');
            
            // First try local build
            const localScript = document.createElement('script');
            localScript.async = true;
            localScript.src = './dist/oonly.min.js';
            localScript.setAttribute('data-project-id', 'test-project-123');
            
            localScript.onload = function() {
                debug.innerHTML += '<br>✅ Loaded from local build';
                checkTrackerStatus();
            };
            
            localScript.onerror = function() {
                debug.innerHTML += '<br>❌ Local build failed, trying GitHub Pages...';
                
                // Fallback to GitHub Pages
                const ghScript = document.createElement('script');
                ghScript.async = true;
                ghScript.src = 'https://ziyanabbas.github.io/oonly-cdn/oonly.min.js';
                ghScript.setAttribute('data-project-id', 'test-project-123');
                
                ghScript.onload = function() {
                    debug.innerHTML += '<br>✅ Loaded from GitHub Pages';
                    checkTrackerStatus();
                };
                
                ghScript.onerror = function() {
                    debug.innerHTML += '<br>❌ GitHub Pages also failed';
                    document.getElementById('status').innerHTML = '❌ Tracker failed to load from all sources';
                };
                
                document.head.appendChild(ghScript);
            };
            
            document.head.appendChild(localScript);
        }
        
        function checkTrackerStatus() {
            setTimeout(() => {
                if (window.oonly) {
                    document.getElementById('status').innerHTML = '✅ Tracker loaded successfully!';
                    debug.innerHTML += '<br>✅ window.oonly object found';
                    
                    // Check for specific methods
                    if (window.oonly.track) debug.innerHTML += '<br>✅ track method available';
                    if (window.oonly.identify) debug.innerHTML += '<br>✅ identify method available';
                } else {
                    document.getElementById('status').innerHTML = '❌ Tracker loaded but window.oonly not found';
                }
            }, 500);
        }
        
        // Load tracker when page loads
        window.addEventListener('load', loadTracker);
    </script>

    <script>
        function testTracking() {
            if (window.oonly && window.oonly.track) {
                try {
                    window.oonly.track('button_click', { button: 'test_tracking' });
                    document.getElementById('status').innerHTML = '✅ Tracking successful!';
                } catch (error) {
                    document.getElementById('status').innerHTML = '❌ Tracking failed: ' + error.message;
                }
            } else {
                document.getElementById('status').innerHTML = '❌ Tracker not loaded yet';
            }
        }
        
        function testIdentify() {
            if (window.oonly && window.oonly.identify) {
                try {
                    window.oonly.identify('test-user-123', { 
                        name: 'Test User',
                        email: 'test@example.com'
                    });
                    document.getElementById('status').innerHTML = '✅ Identify successful!';
                } catch (error) {
                    document.getElementById('status').innerHTML = '❌ Identify failed: ' + error.message;
                }
            } else {
                document.getElementById('status').innerHTML = '❌ Tracker not loaded yet';
            }
        }
    </script>
</body>
</html>
