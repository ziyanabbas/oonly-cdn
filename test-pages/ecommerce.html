<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-commerce Testing - Oonly Tracker Test</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #fecfef 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 1rem 0;
            margin-bottom: 2rem;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 2rem;
        }
        
        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            color: #333;
        }
        
        .nav-links {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        
        .nav-links a {
            color: #333;
            text-decoration: none;
            padding: 0.5rem 1rem;
            border-radius: 25px;
            transition: all 0.3s ease;
        }
        
        .nav-links a:hover, .nav-links a.active {
            background: rgba(255, 154, 158, 0.3);
            transform: translateY(-2px);
        }
        
        .hero {
            text-align: center;
            padding: 3rem 0;
            margin-bottom: 3rem;
        }
        
        .hero h1 {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #333;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .shopping-cart {
            position: fixed;
            top: 100px;
            right: 20px;
            background: white;
            border-radius: 15px;
            padding: 1rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            z-index: 1000;
            min-width: 250px;
        }
        
        .cart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid #ff9a9e;
            padding-bottom: 0.5rem;
            margin-bottom: 1rem;
        }
        
        .cart-count {
            background: #ff9a9e;
            color: white;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .cart-items {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .cart-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
        }
        
        .cart-total {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 2px solid #ff9a9e;
        }
        
        .checkout-btn {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: #333;
            border: none;
            padding: 1rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            margin-top: 1rem;
            transition: all 0.3s ease;
        }
        
        .checkout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.4);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }
        
        .product-card {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .product-image {
            width: 100%;
            height: 200px;
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            border-radius: 15px;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .product-title {
            font-size: 1.3rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            color: #333;
        }
        
        .product-price {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ff9a9e;
            margin-bottom: 1rem;
        }
        
        .product-description {
            color: #666;
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .product-actions {
            display: flex;
            gap: 1rem;
        }
        
        .btn-primary {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            color: #333;
            border: none;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(255, 154, 158, 0.4);
        }
        
        .btn-secondary {
            background: transparent;
            color: #ff9a9e;
            border: 2px solid #ff9a9e;
            padding: 0.8rem 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: #ff9a9e;
            color: white;
        }
        
        .tracking-info {
            background: rgba(255, 154, 158, 0.2);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border-left: 4px solid #ff9a9e;
        }
        
        .ecommerce-stats {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }
        
        .stat-card {
            text-align: center;
            padding: 1.5rem;
            background: rgba(255, 154, 158, 0.1);
            border-radius: 15px;
        }
        
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: #ff9a9e;
            display: block;
        }
        
        .wishlist {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .wishlist-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            border-bottom: 1px solid #eee;
        }
        
        .wishlist-item:last-child {
            border-bottom: none;
        }
        
        .funnel-section {
            background: white;
            border-radius: 20px;
            padding: 2rem;
            margin: 2rem 0;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
        }
        
        .funnel-steps {
            display: flex;
            justify-content: space-between;
            margin: 2rem 0;
        }
        
        .funnel-step {
            flex: 1;
            text-align: center;
            padding: 1rem;
            background: rgba(255, 154, 158, 0.1);
            margin: 0 0.5rem;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .funnel-step:hover {
            background: rgba(255, 154, 158, 0.2);
            transform: translateY(-2px);
        }
        
        .funnel-step.completed {
            background: #ff9a9e;
            color: white;
        }
        
        @media (max-width: 768px) {
            .shopping-cart {
                position: relative;
                top: auto;
                right: auto;
                margin: 2rem 0;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .funnel-steps {
                flex-direction: column;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Oonly Tracker Script -->
    <script
        defer
        src="/src/tracker.js"
        data-project-id="68a482061f216e82510ebb19"
        data-api="http://127.0.0.1:5000"
        data-ws="ws://127.0.0.1:5000"
        data-ver="v1"
    ></script>

    <div class="container">
        <header>
            <nav>
                <div class="logo">🎯 Oonly Test</div>
                <ul class="nav-links">
                    <li><a href="index.html">Home</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="spa.html">SPA Demo</a></li>
                    <li><a href="forms.html">Forms</a></li>
                    <li><a href="media.html">Media</a></li>
                    <li><a href="ecommerce.html" class="active">E-commerce</a></li>
                </ul>
            </nav>
        </header>

        <!-- Shopping Cart -->
        <div class="shopping-cart" id="shopping-cart">
            <div class="cart-header">
                <h3>🛒 Shopping Cart</h3>
                <span class="cart-count" id="cart-count">0</span>
            </div>
            <div class="cart-items" id="cart-items">
                <p style="text-align: center; color: #999;">Your cart is empty</p>
            </div>
            <div class="cart-total" id="cart-total">Total: $0.00</div>
            <button class="checkout-btn" onclick="proceedToCheckout()">Checkout</button>
        </div>

        <section class="hero">
            <h1>🛍️ E-commerce Tracking Test Suite</h1>
            <p>Complete testing for shopping behavior, conversions, and purchase funnel analytics</p>
        </section>

        <section class="tracking-info">
            <strong>🎯 E-commerce Testing:</strong> This page tests product views, cart actions, wishlist interactions, purchase funnel, abandoned cart recovery, and conversion tracking
        </section>

        <!-- E-commerce Stats Dashboard -->
        <section class="ecommerce-stats">
            <h2>📊 E-commerce Analytics Dashboard</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <span class="stat-number" id="product-views">0</span>
                    <span>Product Views</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="cart-adds">0</span>
                    <span>Cart Additions</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="wishlist-adds">0</span>
                    <span>Wishlist Items</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="purchases">0</span>
                    <span>Purchases</span>
                </div>
            </div>
        </section>

        <!-- Purchase Funnel -->
        <section class="funnel-section" data-oonly-section="purchase-funnel">
            <h2>🛒 Purchase Funnel Progress</h2>
            <div class="funnel-steps">
                <div class="funnel-step" id="step-browse" onclick="trackFunnelStep('browse')">
                    <h3>👀 Browse</h3>
                    <p>Product Discovery</p>
                </div>
                <div class="funnel-step" id="step-view" onclick="trackFunnelStep('view')">
                    <h3>🔍 View</h3>
                    <p>Product Details</p>
                </div>
                <div class="funnel-step" id="step-cart" onclick="trackFunnelStep('cart')">
                    <h3>🛒 Add to Cart</h3>
                    <p>Intent to Purchase</p>
                </div>
                <div class="funnel-step" id="step-checkout" onclick="trackFunnelStep('checkout')">
                    <h3>💳 Checkout</h3>
                    <p>Purchase Process</p>
                </div>
                <div class="funnel-step" id="step-purchase" onclick="trackFunnelStep('purchase')">
                    <h3>✅ Purchase</h3>
                    <p>Conversion Complete</p>
                </div>
            </div>
        </section>

        <!-- Products Grid -->
        <section class="products-grid" id="products-grid">
            <div class="product-card" data-oonly-section="product-analytics-pro">
                <div class="product-image">📊</div>
                <div class="product-title">Analytics Pro Dashboard</div>
                <div class="product-price">$299.00</div>
                <div class="product-description">Professional analytics dashboard with advanced features, real-time tracking, and comprehensive reporting tools.</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('analytics-pro', 'Analytics Pro Dashboard', 299.00)">Add to Cart</button>
                    <button class="btn-secondary" onclick="addToWishlist('analytics-pro', 'Analytics Pro Dashboard', 299.00)">♡ Wishlist</button>
                </div>
            </div>

            <div class="product-card" data-oonly-section="product-session-recorder">
                <div class="product-image">🎬</div>
                <div class="product-title">Session Recorder Plus</div>
                <div class="product-price">$199.00</div>
                <div class="product-description">Advanced session recording with user interaction replay, heatmaps, and behavioral analysis tools.</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('session-recorder', 'Session Recorder Plus', 199.00)">Add to Cart</button>
                    <button class="btn-secondary" onclick="addToWishlist('session-recorder', 'Session Recorder Plus', 199.00)">♡ Wishlist</button>
                </div>
            </div>

            <div class="product-card" data-oonly-section="product-user-insights">
                <div class="product-image">👥</div>
                <div class="product-title">User Insights Engine</div>
                <div class="product-price">$149.00</div>
                <div class="product-description">Deep user behavior analysis with segmentation, persona mapping, and predictive analytics capabilities.</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('user-insights', 'User Insights Engine', 149.00)">Add to Cart</button>
                    <button class="btn-secondary" onclick="addToWishlist('user-insights', 'User Insights Engine', 149.00)">♡ Wishlist</button>
                </div>
            </div>

            <div class="product-card" data-oonly-section="product-conversion-optimizer">
                <div class="product-image">🎯</div>
                <div class="product-title">Conversion Optimizer</div>
                <div class="product-price">$249.00</div>
                <div class="product-description">AI-powered conversion optimization with A/B testing, funnel analysis, and performance recommendations.</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('conversion-optimizer', 'Conversion Optimizer', 249.00)">Add to Cart</button>
                    <button class="btn-secondary" onclick="addToWishlist('conversion-optimizer', 'Conversion Optimizer', 249.00)">♡ Wishlist</button>
                </div>
            </div>

            <div class="product-card" data-oonly-section="product-realtime-alerts">
                <div class="product-image">🚨</div>
                <div class="product-title">Real-time Alerts System</div>
                <div class="product-price">$99.00</div>
                <div class="product-description">Instant notifications for critical events, anomaly detection, and custom alert configurations.</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('realtime-alerts', 'Real-time Alerts System', 99.00)">Add to Cart</button>
                    <button class="btn-secondary" onclick="addToWishlist('realtime-alerts', 'Real-time Alerts System', 99.00)">♡ Wishlist</button>
                </div>
            </div>

            <div class="product-card" data-oonly-section="product-api-integration">
                <div class="product-image">🔌</div>
                <div class="product-title">API Integration Suite</div>
                <div class="product-price">$179.00</div>
                <div class="product-description">Complete API integration package with webhooks, custom endpoints, and third-party connectors.</div>
                <div class="product-actions">
                    <button class="btn-primary" onclick="addToCart('api-integration', 'API Integration Suite', 179.00)">Add to Cart</button>
                    <button class="btn-secondary" onclick="addToWishlist('api-integration', 'API Integration Suite', 179.00)">♡ Wishlist</button>
                </div>
            </div>
        </section>

        <!-- Wishlist Section -->
        <section class="wishlist" id="wishlist-section" style="display: none;">
            <h2>💝 Your Wishlist</h2>
            <div id="wishlist-items">
                <p style="text-align: center; color: #999;">Your wishlist is empty</p>
            </div>
        </section>

        <footer style="text-align: center; padding: 2rem 0; opacity: 0.8;">
            <p>&copy; 2024 Oonly Tracker - E-commerce & Conversion Testing</p>
        </footer>
    </div>

    <script>
        // E-commerce tracking data
        let ecommerceStats = {
            productViews: 0,
            cartAdds: 0,
            wishlistAdds: 0,
            purchases: 0,
            cartTotal: 0
        };
        
        let cart = [];
        let wishlist = [];
        let funnelProgress = {
            browse: false,
            view: false,
            cart: false,
            checkout: false,
            purchase: false
        };

        // Track page load and product catalog view
        document.addEventListener('DOMContentLoaded', () => {
            if (window.oonly && window.oonly.track) {
                window.oonly.track('ecommerce_page_view', {
                    page: 'product_catalog',
                    productsDisplayed: document.querySelectorAll('.product-card').length,
                    timestamp: Date.now()
                });
            }
            
            // Mark browse step as completed
            trackFunnelStep('browse');
            
            // Track product impressions
            trackProductImpressions();
        });

        // Track product impressions (products visible on page load)
        function trackProductImpressions() {
            const products = document.querySelectorAll('.product-card');
            products.forEach((product, index) => {
                const productName = product.querySelector('.product-title').textContent;
                const productPrice = parseFloat(product.querySelector('.product-price').textContent.replace('$', ''));
                
                if (window.oonly && window.oonly.track) {
                    window.oonly.track('product_impression', {
                        productName: productName,
                        productPrice: productPrice,
                        position: index + 1,
                        category: 'analytics_tools',
                        timestamp: Date.now()
                    });
                }
            });
        }

        // Add to cart functionality
        function addToCart(productId, productName, price) {
            // Check if product already in cart
            const existingItem = cart.find(item => item.id === productId);
            if (existingItem) {
                existingItem.quantity += 1;
            } else {
                cart.push({
                    id: productId,
                    name: productName,
                    price: price,
                    quantity: 1
                });
            }
            
            // Update stats
            ecommerceStats.cartAdds++;
            ecommerceStats.cartTotal += price;
            updateStats();
            updateCartDisplay();
            
            // Track add to cart event
            if (window.oonly && window.oonly.track) {
                window.oonly.track('add_to_cart', {
                    productId: productId,
                    productName: productName,
                    productPrice: price,
                    cartTotal: ecommerceStats.cartTotal,
                    cartItems: cart.length,
                    timestamp: Date.now()
                });
                
                // Update user properties
                if (window.oonly.set) {
                    window.oonly.set({
                        cartValue: ecommerceStats.cartTotal,
                        cartItems: cart.length,
                        lastCartUpdate: Date.now(),
                        interestedInPurchase: true
                    });
                }
            }
            
            // Mark cart step as completed
            trackFunnelStep('cart');
            
            // Visual feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '✅ Added!';
            button.style.background = '#4CAF50';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
            }, 2000);
        }

        // Add to wishlist functionality
        function addToWishlist(productId, productName, price) {
            // Check if product already in wishlist
            if (wishlist.find(item => item.id === productId)) {
                alert('Product already in wishlist!');
                return;
            }
            
            wishlist.push({
                id: productId,
                name: productName,
                price: price,
                addedAt: Date.now()
            });
            
            // Update stats
            ecommerceStats.wishlistAdds++;
            updateStats();
            updateWishlistDisplay();
            
            // Track add to wishlist event
            if (window.oonly && window.oonly.track) {
                window.oonly.track('add_to_wishlist', {
                    productId: productId,
                    productName: productName,
                    productPrice: price,
                    wishlistItems: wishlist.length,
                    timestamp: Date.now()
                });
                
                // Update user properties
                if (window.oonly.set) {
                    window.oonly.set({
                        wishlistItems: wishlist.length,
                        lastWishlistUpdate: Date.now(),
                        showsIntent: true
                    });
                }
            }
            
            // Visual feedback
            const button = event.target;
            const originalText = button.textContent;
            button.textContent = '💖 Added!';
            button.style.background = '#ff9a9e';
            button.style.color = 'white';
            
            setTimeout(() => {
                button.textContent = originalText;
                button.style.background = '';
                button.style.color = '';
            }, 2000);
        }

        // Remove from cart
        function removeFromCart(productId) {
            const itemIndex = cart.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                const item = cart[itemIndex];
                ecommerceStats.cartTotal -= item.price * item.quantity;
                cart.splice(itemIndex, 1);
                
                updateStats();
                updateCartDisplay();
                
                // Track remove from cart
                if (window.oonly && window.oonly.track) {
                    window.oonly.track('remove_from_cart', {
                        productId: productId,
                        cartTotal: ecommerceStats.cartTotal,
                        cartItems: cart.length,
                        timestamp: Date.now()
                    });
                }
            }
        }

        // Checkout process
        function proceedToCheckout() {
            if (cart.length === 0) {
                alert('Your cart is empty!');
                return;
            }
            
            // Track checkout initiation
            if (window.oonly && window.oonly.track) {
                window.oonly.track('checkout_initiated', {
                    cartTotal: ecommerceStats.cartTotal,
                    cartItems: cart.length,
                    products: cart.map(item => ({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: item.quantity
                    })),
                    timestamp: Date.now()
                });
            }
            
            // Mark checkout step as completed
            trackFunnelStep('checkout');
            
            // Simulate checkout process
            setTimeout(() => {
                completePurchase();
            }, 2000);
            
            alert('Proceeding to checkout...');
        }

        // Complete purchase
        function completePurchase() {
            const orderId = 'ORD_' + Date.now();
            const orderTotal = ecommerceStats.cartTotal;
            const orderItems = [...cart];
            
            // Track purchase completion
            if (window.oonly && window.oonly.track) {
                window.oonly.track('purchase_completed', {
                    orderId: orderId,
                    orderTotal: orderTotal,
                    orderItems: orderItems.length,
                    products: orderItems.map(item => ({
                        id: item.id,
                        name: item.name,
                        price: item.price,
                        quantity: item.quantity
                    })),
                    paymentMethod: 'credit_card', // Simulated
                    timestamp: Date.now()
                });
                
                // Update user properties
                if (window.oonly.set) {
                    window.oonly.set({
                        totalPurchases: (window.oonly.getUserProperties().totalPurchases || 0) + 1,
                        totalSpent: (window.oonly.getUserProperties().totalSpent || 0) + orderTotal,
                        lastPurchaseDate: Date.now(),
                        customerStatus: 'paying_customer'
                    });
                }
            }
            
            // Update stats
            ecommerceStats.purchases++;
            updateStats();
            
            // Clear cart
            cart = [];
            ecommerceStats.cartTotal = 0;
            updateCartDisplay();
            
            // Mark purchase step as completed
            trackFunnelStep('purchase');
            
            alert(`🎉 Purchase completed! Order ID: ${orderId}\nTotal: $${orderTotal.toFixed(2)}`);
        }

        // Track funnel steps
        function trackFunnelStep(step) {
            if (!funnelProgress[step]) {
                funnelProgress[step] = true;
                
                // Visual update
                const stepElement = document.getElementById(`step-${step}`);
                if (stepElement) {
                    stepElement.classList.add('completed');
                }
                
                // Track funnel progression
                if (window.oonly && window.oonly.track) {
                    window.oonly.track('funnel_step_completed', {
                        step: step,
                        stepOrder: Object.keys(funnelProgress).indexOf(step) + 1,
                        funnelProgress: Object.values(funnelProgress).filter(Boolean).length,
                        totalSteps: Object.keys(funnelProgress).length,
                        timestamp: Date.now()
                    });
                }
            }
        }

        // Update statistics display
        function updateStats() {
            document.getElementById('product-views').textContent = ecommerceStats.productViews;
            document.getElementById('cart-adds').textContent = ecommerceStats.cartAdds;
            document.getElementById('wishlist-adds').textContent = ecommerceStats.wishlistAdds;
            document.getElementById('purchases').textContent = ecommerceStats.purchases;
        }

        // Update cart display
        function updateCartDisplay() {
            const cartCount = document.getElementById('cart-count');
            const cartItems = document.getElementById('cart-items');
            const cartTotal = document.getElementById('cart-total');
            
            cartCount.textContent = cart.reduce((sum, item) => sum + item.quantity, 0);
            cartTotal.textContent = `Total: $${ecommerceStats.cartTotal.toFixed(2)}`;
            
            if (cart.length === 0) {
                cartItems.innerHTML = '<p style="text-align: center; color: #999;">Your cart is empty</p>';
            } else {
                cartItems.innerHTML = cart.map(item => `
                    <div class="cart-item">
                        <div>
                            <div style="font-weight: bold;">${item.name}</div>
                            <div>$${item.price.toFixed(2)} x ${item.quantity}</div>
                        </div>
                        <button onclick="removeFromCart('${item.id}')" style="background: none; border: none; color: #ff9a9e; cursor: pointer; font-size: 1.2rem;">×</button>
                    </div>
                `).join('');
            }
        }

        // Update wishlist display
        function updateWishlistDisplay() {
            const wishlistSection = document.getElementById('wishlist-section');
            const wishlistItems = document.getElementById('wishlist-items');
            
            if (wishlist.length > 0) {
                wishlistSection.style.display = 'block';
                wishlistItems.innerHTML = wishlist.map(item => `
                    <div class="wishlist-item">
                        <div>
                            <div style="font-weight: bold;">${item.name}</div>
                            <div style="color: #ff9a9e;">$${item.price.toFixed(2)}</div>
                        </div>
                        <div>
                            <button class="btn-primary" onclick="moveToCart('${item.id}')" style="margin-right: 0.5rem;">Move to Cart</button>
                            <button onclick="removeFromWishlist('${item.id}')" style="background: none; border: none; color: #ff9a9e; cursor: pointer;">Remove</button>
                        </div>
                    </div>
                `).join('');
            } else {
                wishlistSection.style.display = 'none';
            }
        }

        // Move item from wishlist to cart
        function moveToCart(productId) {
            const item = wishlist.find(w => w.id === productId);
            if (item) {
                addToCart(item.id, item.name, item.price);
                removeFromWishlist(productId);
                
                if (window.oonly && window.oonly.track) {
                    window.oonly.track('wishlist_to_cart', {
                        productId: productId,
                        productName: item.name,
                        timestamp: Date.now()
                    });
                }
            }
        }

        // Remove from wishlist
        function removeFromWishlist(productId) {
            const itemIndex = wishlist.findIndex(item => item.id === productId);
            if (itemIndex > -1) {
                wishlist.splice(itemIndex, 1);
                ecommerceStats.wishlistAdds = Math.max(0, ecommerceStats.wishlistAdds - 1);
                updateStats();
                updateWishlistDisplay();
                
                if (window.oonly && window.oonly.track) {
                    window.oonly.track('remove_from_wishlist', {
                        productId: productId,
                        wishlistItems: wishlist.length,
                        timestamp: Date.now()
                    });
                }
            }
        }

        // Track product card interactions
        document.querySelectorAll('.product-card').forEach(card => {
            let viewStartTime = null;
            
            // Track product view when card comes into view
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting && !viewStartTime) {
                        viewStartTime = Date.now();
                        const productName = card.querySelector('.product-title').textContent;
                        const productPrice = parseFloat(card.querySelector('.product-price').textContent.replace('$', ''));
                        
                        ecommerceStats.productViews++;
                        updateStats();
                        trackFunnelStep('view');
                        
                        if (window.oonly && window.oonly.track) {
                            window.oonly.track('product_view', {
                                productName: productName,
                                productPrice: productPrice,
                                viewMethod: 'scroll_into_view',
                                timestamp: Date.now()
                            });
                        }
                    } else if (!entry.isIntersecting && viewStartTime) {
                        const viewDuration = Date.now() - viewStartTime;
                        viewStartTime = null;
                        
                        if (window.oonly && window.oonly.track) {
                            window.oonly.track('product_view_duration', {
                                productName: card.querySelector('.product-title').textContent,
                                viewDuration: viewDuration,
                                timestamp: Date.now()
                            });
                        }
                    }
                });
            }, { threshold: 0.5 });
            
            observer.observe(card);
            
            // Track product card hover
            let hoverStartTime = null;
            card.addEventListener('mouseenter', () => {
                hoverStartTime = Date.now();
            });
            
            card.addEventListener('mouseleave', () => {
                if (hoverStartTime) {
                    const hoverDuration = Date.now() - hoverStartTime;
                    const productName = card.querySelector('.product-title').textContent;
                    
                    if (window.oonly && window.oonly.track) {
                        window.oonly.track('product_hover', {
                            productName: productName,
                            hoverDuration: hoverDuration,
                            timestamp: Date.now()
                        });
                    }
                    hoverStartTime = null;
                }
            });
        });

        // Track cart abandonment on page unload
        window.addEventListener('beforeunload', () => {
            if (cart.length > 0) {
                if (window.oonly && window.oonly.track) {
                    window.oonly.track('cart_abandonment', {
                        cartTotal: ecommerceStats.cartTotal,
                        cartItems: cart.length,
                        timeOnPage: Date.now() - performance.navigationStart,
                        funnelProgress: funnelProgress,
                        timestamp: Date.now()
                    });
                }
            }
            
            // Track overall e-commerce session
            if (window.oonly && window.oonly.track) {
                window.oonly.track('ecommerce_session_end', {
                    productViews: ecommerceStats.productViews,
                    cartAdds: ecommerceStats.cartAdds,
                    wishlistAdds: ecommerceStats.wishlistAdds,
                    purchases: ecommerceStats.purchases,
                    conversionRate: ecommerceStats.productViews > 0 ? (ecommerceStats.purchases / ecommerceStats.productViews * 100).toFixed(2) : 0,
                    timestamp: Date.now()
                });
            }
        });

        // Simulate some automatic behaviors for testing
        setTimeout(() => {
            // Simulate user browsing behavior
            if (window.oonly && window.oonly.track) {
                window.oonly.track('browse_pattern', {
                    pattern: 'systematic',
                    timeToFirstProductView: 3000,
                    timestamp: Date.now()
                });
            }
        }, 3000);
    </script>
</body>
</html>
